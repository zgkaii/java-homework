# 作业2

**题目描述**：写代码实现 Spring Bean 的装配，方式越多越好（XML、Annotation 都可以）。

------

> Bean的装配就是将Bean装配注入到Spring IoC容器中，也就是所谓的依赖注入。

## 1 基于XML的装配

### 1.1 设值注入(Setter Injection)

* 定义`IAccountService`接口

```java
public interface IAccountService {
    void saveAccount();
}
```

* 接口实现类`AccountServiceImpl`

```java
public class AccountServiceImpl implements IAccountService {
    private String name;
    private Integer age;
    private Date birthday;

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public void setBirthday(Date birthday) {
        this.birthday = birthday;
    }

    @Override
    public void saveAccount() {
        System.out.println(name + "," + age + "," + birthday);
    }
}
```

* 配置文件`applicationContext.xml`

```xml
    <!-- 配置一个日期对象 -->
    <bean id="now" class="java.util.Date"></bean>
    <!-- set方法注入 -->
    <bean id="accountService1" class="com.zgkaii.spring.mission.mission2.impl.AccountServiceImpl">
        <property name="name" value="zhangsan"></property>
        <property name="age" value="22"></property>
        <property name="birthday" ref="now"></property>
    </bean>
```

* 创建测试方法`testString()`

```java
    @Test
    public void testString() {
        // 定义Spring配置文件的路径
        String xmlPath = "applicationContext.xml";
        // 初始化Spring容器，加载配置文件
        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(
                xmlPath);
        // 通过容器获取IAccountService实例
        IAccountService as = (IAccountService) applicationContext
                .getBean("accountService1");
        // 调用IAccountService的save()方法
        as.saveAccount();
    }
```

* 运行结果

```java
zhangsan,22,Sat Apr 17 21:39:29 CST 2021
```

### 1.2 构造注入(Constructor Injection)

* 创建实现类`AccountServiceImpl2`

```java
public class AccountServiceImpl2 implements IAccountService {
    private String name;
    private Integer age;
    private Date birthday;

    public AccountServiceImpl2(String name, Integer age, Date birthday) {
        this.name = name;
        this.age = age;
        this.birthday = birthday;
    }

    @Override
    public void saveAccount() {
        System.out.println(name + "," + age + "," + birthday);
    }
}
```

* 修改配置文件`applicationContext.xml`

```xml
    <!-- 构造函数注入 -->
    <bean id="accountService2" class="com.zgkaii.spring.mission.mission2.impl.AccountServiceImpl2">
        <constructor-arg name="name" value="lisi"></constructor-arg>
        <constructor-arg name="age" value="18"></constructor-arg>
        <constructor-arg name="birthday" ref="now"></constructor-arg>
    </bean>
```

* 创建测试方法`testString()`

```java
    @Test
    public void testString() {
        // 定义Spring配置文件的路径
        String xmlPath = "applicationContext.xml";
        // 初始化Spring容器，加载配置文件
        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(
                xmlPath);
        // 通过容器获取IAccountService实例
        IAccountService as = (IAccountService) applicationContext
                .getBean("accountService2");
        // 调用IAccountService的save()方法
        as.saveAccount();
    }
```

* 运行结果

```java
lisi,18,Sat Apr 17 21:50:46 CST 2021
```

### 1.3 集合类型的注入

一下集合类型的注入都是采用的设值注入。

* 创建实现类`AccountServiceImpl3`

```java
@Data
public class AccountServiceImpl3 implements IAccountService {

    private String[] myStrs;
    private List<String> myList;
    private Set<String> mySet;
    private Map<String, String> myMap;
    private Properties myProps;

    @Override
    public void saveAccount() {
        System.out.println(Arrays.toString(myStrs));
        System.out.println(myList);
        System.out.println(mySet);
        System.out.println(myMap);
        System.out.println(myProps);
    }
}

```

* 修改配置文件`applicationContext.xml`

```xml
    <!-- 复杂类型的注入/集合类型的注入 -->
    <bean id="accountService3" class="com.zgkaii.spring.mission.mission2.impl.AccountServiceImpl3">
        <property name="myStrs">
            <set>
                <value>AAA</value>
                <value>BBB</value>
                <value>CCC</value>
            </set>
        </property>

        <property name="myList">
            <array>
                <value>AAA</value>
                <value>BBB</value>
                <value>CCC</value>
            </array>
        </property>

        <property name="mySet">
            <list>
                <value>AAA</value>
                <value>BBB</value>
                <value>CCC</value>
            </list>
        </property>

        <property name="myMap">
            <props>
                <prop key="testC">ccc</prop>
                <prop key="testD">ddd</prop>
            </props>
        </property>

        <property name="myProps">
            <map>
                <entry key="testA" value="aaa"></entry>
                <entry key="testB">
                    <value>BBB</value>
                </entry>
            </map>
        </property>
    </bean>

```

* 创建测试方法`testString()`

```java
    @Test
    public void testString() {
        // 定义Spring配置文件的路径
        String xmlPath = "applicationContext.xml";
        // 初始化Spring容器，加载配置文件
        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(
                xmlPath);
        // 通过容器获取IAccountService实例
        IAccountService as = (IAccountService) applicationContext
                .getBean("accountService3");
        // 调用IAccountService的save()方法
        as.saveAccount();
    }
```

* 运行结果

```java
[AAA, BBB, CCC]
[AAA, BBB, CCC]
[AAA, BBB, CCC]
{testD=ddd, testC=ccc}
{testA=aaa, testB=BBB}
```

## 2 基于Annotation装配

### 2.1 半自动注解配置

* 创建DAO层接口

```java
public interface UserDao {
    public void save();
}
```

* 创建 DAO 层接口的实现类

```java
@Repository("userDao")
public class UserDaoImpl implements UserDao {
    @Override
    public void save() {
        System.out.println("数据访问层的save()方法执行了");
    }
}
```

* 创建 Service 层接口

```java
public interface UserService {
    public void add();
}
```

* 创建 Service 层接口的实现类

```java
@Service("userService")
public class UserServiceImpl implements UserService {

    @Resource(name = "userDao")
    private UserDao userDao;
    
    public UserDao getUserDao() {
        return userDao;
    }
    
    @Override
    public void add() {
        userDao.save();
        System.out.println("业务层的add()方法执行了");
    }
}
```

* 创建UserController

```java
@Controller("userController")
public class UserController {
    @Resource(name = "userService")
    private UserService userService;

    public UserService getUserService() {
        return userService;
    }
    
    public void testFunc() {
        userService.add();
        System.out.println("控制层的testFunc()方法执行了");
    }
}
```

* 创建 Spring 配置文件

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd">

    <!-- 使用context 命名空间，通知Spring扫描指定包下所有Bean类，进行注解解析 -->
    <context:component-scan base-package="com.zgkaii.spring.mission"></context:component-scan>
</beans>
```

* 创建测试类

```java
public class UserControllerTests {
    @Test
    public void test() {
        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(
                "applicationContext.xml");
        UserController userController = (UserController) applicationContext
                .getBean("userController");
        userController.testFunc();
        userController.save();
    }
}
```

* 运行程序并查看结果

```java
数据访问层的save()方法执行了
业务层的add()方法执行了
控制层的testFunc()方法执行了
```

### 2.2 Java Config配置

从Spring 3.0开始，Java Config来代替applicationContext.xml装配Bean。主要使用的注解有`@Configuration`、`@ComponentScan`和`@Bean`等。

* UserDao与UserDaoImpl保持不变

```java
public interface UserDao {
    public void save();
}

public class UserDaoImpl implements UserDao {
    @Override
    public void save() {
        System.out.println("数据访问层的save()方法执行了");
    }
}
```

* UserService与UserServiceImpl

```java
public interface UserService {
    public void add();
}

public class UserServiceImpl implements UserService {
    @Override
    public void add() {
        System.out.println("业务层的add()方法执行了");
    }
}
```

* UserController

```java
public class UserController {
    public void testFunc() {
        System.out.println("控制层的testFunc()方法执行了");
    }
}
```

* 创建配置类SpringConfig

```java
@Configuration
public class SpringConfig {

    @Bean
    public UserService userService() {
        return new UserServiceImpl();
    }

    @Bean
    public UserDao userDao() {
        return new UserDaoImpl();
    }

    @Bean
    public UserController userController() {
        return new UserController();
    }
}
```

* 创建测试类

```java
public class MissonTest {

    @Test
    public void testString() {
        // 通过Java配置来实例化Spring容器
        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(SpringConfig.class);
        // 在Spring容器中获取Bean对象
        UserController userController = context.getBean(UserController.class);
        UserDao userDao = context.getBean(UserDao.class);
        UserService userService = context.getBean(UserService.class);
        // 调用对象中的方法
        userController.testFunc();
        userDao.save();
        userService.add();
        // 销毁该容器
        context.destroy();
    }
}
```

* 测试结果

```java
控制层的testFunc()方法执行了
数据访问层的save()方法执行了
业务层的add()方法执行了
```